!function e(t,n,r){function o(i,s){if(!n[i]){if(!t[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){var n=t[i][1][e];return o(n||e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./SubjectObserver"),i=(r=a)&&r.__esModule?r:{default:r};var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.total=0,n.isBusy=!1,n.imgLoadFunc="lazyLoad",n.noImgClass="no-image",n.delay=500,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"setTotal",value:function(e){this.total=e}},{key:"toggleBusy",value:function(){this.isBusy=!this.isBusy}},{key:"setObservers",value:function(e){e.forEach(function(e){e.notifies.forEach(function(t){t.observers.forEach(function(n){e.instance.addObserver(t.name,n.instance,n.callback)})})})}},{key:"setEventHandlers",value:function(e){var t=this;window[this.imgLoadFunc]=function(e){return t.imgLoadHandler(e)},window.onerror=function(e){t.notify("showError",new Error(e))},document.getElementById(this.appId).addEventListener("click",function(n){var r=n||window.event,o=r.target||r.srcElement;if("button"!==o.tagName.toLowerCase()||1==o.disabled)return!1;o.hasAttribute("data-download")&&t.itemsDownloadHandler(o,e),o.hasAttribute("data-delete")&&t.itemDelHandler(o)})}},{key:"imgLoadHandler",value:function(e){var t=this,n=e.getAttribute("data-image"),r=new Image;r.onload=function(){e.src=n,e.onload=null,e.removeAttribute("onload"),e.classList.toggle(t.noImgClass),e.removeAttribute("data-image")},r.src=n}},{key:"itemDelHandler",value:function(e){var t=this;if(this.isBusy)return!1;this.toggleBusy(),e.classList.toggle(this.loadingClass);var n={id:e.getAttribute("data-delete"),elem:e};setTimeout(function(){t.notify("removeElem",n),t.toggleBusy()},this.delay)}},{key:"itemsDownloadHandler",value:function(e,t){var n=this;if(this.isBusy)return!1;this.toggleBusy(),e.classList.toggle(this.loadingClass);var r=[].slice.call(document.getElementById(this.itemsId).children).length;this.total>r&&setTimeout(function(){n.notify("showMore",t.restore()),e.classList.toggle(n.loadingClass),r+n.perRow>=n.total&&e.setAttribute("disabled","disabled"),n.toggleBusy()},this.delay)}}]),t}();n.default=s},{"./SubjectObserver":6}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=e("./SubjectObserver"),a=(r=o)&&r.__esModule?r:{default:r};var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.url="http://81.177.101.143:30080/test.json",n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),t}();n.default=i},{"./SubjectObserver":6}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./LoadManager"),i=(r=a)&&r.__esModule?r:{default:r},s=e("./config");var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.url="http://www.whateverorigin.org/get?url=http://81.177.101.143:30080/test.json",n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"load",value:function(){var e=this;return new s.Promise(function(t,n){var r="jsonp_callback_"+Math.round(1e5*Math.random());window[r]=function(e){delete window[r],document.body.removeChild(o),t(e)};var o=document.createElement("script");o.src=e.url+(~e.url.indexOf("?")?"&":"?")+"callback="+r,document.body.appendChild(o),o.onerror=function(e){n(e)}})}}]),t}();n.default=u},{"./LoadManager":2,"./config":9}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.list={}}return r(e,[{key:"add",value:function(e,t,n){Array.isArray(this.list[e])||(this.list[e]=[]),this.list[e].push({instance:t,callback:n})}}]),e}();n.default=o},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./SubjectObserver"),i=(r=a)&&r.__esModule?r:{default:r};var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="rostelecom",n.data=null,n.type="sessionStorage",n.sortProp="age",n.shownIds=[],n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"totalNum",value:function(){return this.data?this.total=this.data.length:this.total=JSON.parse(window[this.type].getItem(this.name)).length}},{key:"removeItemId",value:function(e){~this.shownIds.indexOf(e.id)&&this.shownIds.splice(this.shownIds.indexOf(e.id),1)}},{key:"isAvailable",value:function(){try{var e=window[this.type],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}},{key:"isEmpty",value:function(){return!this.isAvailable()||!window[this.type].getItem(this.name)}},{key:"save",value:function(e){if(!e)return!1;if(!this.isAvailable())return this.data=e,!1;try{return window[this.type].setItem(this.name,JSON.stringify(e)),this.name}catch(t){return this.data=e,!1}}},{key:"sort",value:function(e){var t=this;return e.slice(0).sort(function(e,n){return e[t.sortProp]>n[t.sortProp]?1:e[t.sortProp]<n[t.sortProp]?-1:0})}},{key:"paginate",value:function(e){var t=this,n=[],r=0;return e.every(function(e){return r!==t.perRow&&t.shownIds.length!==t.totalNum()&&(~t.shownIds.indexOf(e.id)||(n.push(e),t.shownIds.push(e.id),r++),!0)}),n}},{key:"restore",value:function(){return this.data?this.paginate(this.sort(this.data)):this.paginate(this.sort(JSON.parse(window[this.type].getItem(this.name))))}}]),t}();n.default=s},{"./SubjectObserver":6}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observers=t,this.appId="container",this.itemsId="items",this.loadingClass="loading",this.perRow=4}return r(e,[{key:"addObserver",value:function(e,t,n){this.observers.add(e,t,n)}},{key:"notify",value:function(e,t){this.observers.list[e].forEach(function(e){return e.instance.update(e.callback,t)})}},{key:"update",value:function(e,t){e.call(this,t)}}]),e}();n.default=o},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./SubjectObserver"),i=(r=a)&&r.__esModule?r:{default:r},s=e("./config");var u=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"ready",value:function(){return new s.Promise(function(e,t){"interactive"!==document.readyState&&"complete"!==document.readyState||e(document.readyState),document.onreadystatechange=function(){~["interactive","complete"].indexOf(document.readyState)&&(e(document.readyState),document.onreadystatechange=null)}})}},{key:"renderView",value:function(e){var t=document.getElementById(this.appId),n='<div id="'+this.itemsId+'">'+this.templateItems(e)+'</div>\n                <button data-download><img src="spinner.gif">download</button>';t.innerHTML=n}},{key:"renderErrorView",value:function(e){var t=document.getElementById(this.appId),n='<div class="error">Ups...something went wrong!\n                Try to visit this page later.<pre><code><strong>'+e.name+"</strong>\n"+e.message+"\n"+e.stack+"</code></pre></div>";t.innerHTML=n}},{key:"renderItems",value:function(e){document.getElementById(this.itemsId).insertAdjacentHTML("afterbegin",this.templateItems(e))}},{key:"deleteItem",value:function(e){var t=e.elem;t.classList.toggle(this.loadingClass);var n=t.parentNode.parentNode.parentNode;n.parentNode.removeChild(n),document.getElementById(this.appId).lastElementChild.removeAttribute("disabled")}},{key:"templateItems",value:function(e){var t=this,n="";return e.forEach(function(e){n+=t.templateItem(e)}),n}},{key:"templateItem",value:function(e){return this.shown++,'<div class="item">\n              <img data-image="'+e.imageUrl+'" onload="lazyLoad(this)" src="spinner.gif" class="no-image"/>\n              <div class="flex">\n                <div class="content front"><span>'+e.name+'</span></div>\n                <div class="content back">\n                  <span>'+e.name+"</span>\n                  <span>"+e.text+'</span>\n                  <button data-delete="'+e.id+'"><img src="spinner.gif">delete</button>\n                </div>\n              </div>\n            </div>'}}]),t}();n.default=u},{"./SubjectObserver":6,"./config":9}],8:[function(e,t,n){"use strict";var r=e("./config"),o=r.storageManager.isEmpty()?r.loadManager.load():r.Promise.resolve(!1),a=r.viewManager.ready();r.Promise.all([o,a]).then(function(e){try{r.loadManager.notify("dataLoaded",e[0].contents),r.loadManager.notify("totalNum",r.storageManager.totalNum()),r.eventManager.setEventHandlers(r.storageManager),r.eventManager.notify("handlersReady",r.storageManager.restore())}catch(e){r.eventManager.notify("showError",e)}},function(e){r.eventManager.notify("showError",e)})},{"./config":9}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Promise=n.eventManager=n.storageManager=n.viewManager=n.loadManager=void 0;var r=u(e("./ObserverList")),o=u(e("./ViewManager")),a=u(e("./EventManager")),i=u(e("./LoadManagerProxy")),s=u(e("./StorageManager"));function u(e){return e&&e.__esModule?e:{default:e}}var c=e("../../node_modules/es6-promise-polyfill/promise.min.js").Promise,l=new i.default(new r.default),f=new o.default(new r.default),d=new s.default(new r.default),p=new a.default(new r.default),h=[{instance:l,notifies:[{name:"dataLoaded",observers:[{instance:d,callback:d.save}]},{name:"totalNum",observers:[{instance:p,callback:p.setTotal}]}]},{instance:f,notifies:[{name:"domReady",observers:[{instance:p,callback:p.setHandlers}]}]},{instance:p,notifies:[{name:"handlersReady",observers:[{instance:f,callback:f.renderView}]},{name:"showMore",observers:[{instance:f,callback:f.renderItems}]},{name:"showError",observers:[{instance:f,callback:f.renderErrorView}]},{name:"removeElem",observers:[{instance:d,callback:d.removeItemId},{instance:f,callback:f.deleteItem}]}]}];p.setObservers(h),n.loadManager=l,n.viewManager=f,n.storageManager=d,n.eventManager=p,n.Promise=c},{"../../node_modules/es6-promise-polyfill/promise.min.js":10,"./EventManager":1,"./LoadManagerProxy":3,"./ObserverList":4,"./StorageManager":5,"./ViewManager":7}],10:[function(e,t,n){(function(e){!function(e){function t(){for(var e=0;e<j.length;e++)j[e][0](j[e][1]);j=[],v=!1}function r(e,n){j.push([e,n]),v||(v=!0,O(t,0))}function o(e){var t=(n=e.owner).state_,n=n.data_,r=e[t];if(e=e.then,"function"==typeof r){t=g;try{n=r(n)}catch(t){u(e,t)}}a(e,n)||(t===g&&i(e,n),t===w&&u(e,n))}function a(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"==typeof t)){var r=t.then;if("function"==typeof r)return r.call(t,function(r){n||(n=!0,t!==r?i(e,r):s(e,r))},function(t){n||(n=!0,u(e,t))}),!0}}catch(t){return n||u(e,t),!0}return!1}function i(e,t){e!==t&&a(e,t)||s(e,t)}function s(e,t){e.state_===m&&(e.state_=b,e.data_=t,r(l,e))}function u(e,t){e.state_===m&&(e.state_=b,e.data_=t,r(f,e))}function c(e){var t=e.then_;for(e.then_=void 0,e=0;e<t.length;e++)o(t[e])}function l(e){e.state_=g,c(e)}function f(e){e.state_=w,c(e)}function d(e){if("function"!=typeof e)throw new TypeError("Promise constructor takes a function argument");if(!1==this instanceof d)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(e,t){function n(e){u(t,e)}try{e(function(e){i(t,e)},n)}catch(e){n(e)}}(e,this)}var p,h=e.Promise,y=h&&"resolve"in h&&"reject"in h&&"all"in h&&"race"in h&&(new h(function(e){p=e}),"function"==typeof p);void 0!==n&&n?(n.Promise=y?h:d,n.Polyfill=d):"function"==typeof define&&define.amd?define(function(){return y?h:d}):y||(e.Promise=d);var v,m="pending",b="sealed",g="fulfilled",w="rejected",_=function(){},O="undefined"!=typeof setImmediate?setImmediate:setTimeout,j=[];d.prototype={constructor:d,state_:m,then_:null,data_:void 0,then:function(e,t){var n={owner:this,then:new this.constructor(_),fulfilled:e,rejected:t};return this.state_===g||this.state_===w?r(o,n):this.then_.push(n),n.then},catch:function(e){return this.then(null,e)}},d.all=function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("You must pass an array to Promise.all().");return new this(function(t,n){function r(e){return i++,function(n){a[e]=n,--i||t(a)}}for(var o,a=[],i=0,s=0;s<e.length;s++)(o=e[s])&&"function"==typeof o.then?o.then(r(s),n):a[s]=o;i||t(a)})},d.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("You must pass an array to Promise.race().");return new this(function(t,n){for(var r,o=0;o<e.length;o++)(r=e[o])&&"function"==typeof r.then?r.then(t,n):t(r)})},d.resolve=function(e){return e&&"object"==typeof e&&e.constructor===this?e:new this(function(t){t(e)})},d.reject=function(e){return new this(function(t,n){n(e)})}}("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[8]);
//# sourceMappingURL=app.js.map
