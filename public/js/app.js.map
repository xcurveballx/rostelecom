{"version":3,"sources":["node_modules/browser-pack/_prelude.js","assets/js/EventManager.js","assets/js/LoadManager.js","assets/js/LoadManagerProxy.js","assets/js/ObserverList.js","assets/js/StorageManager.js","assets/js/SubjectObserver.js","assets/js/ViewManager.js","assets/js/app.js","assets/js/config.js","node_modules/es6-promise-polyfill/promise.min.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_SubjectObserver2","EventManager","ObserverList","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","total","isBusy","imgLoadFunc","noImgClass","delay","config","forEach","subject","notifies","evt","observers","observer","instance","addObserver","name","callback","storageManager","_this2","window","elem","imgLoadHandler","onerror","msg","notify","document","getElementById","appId","addEventListener","event","target","srcElement","tagName","toLowerCase","disabled","hasAttribute","itemsDownloadHandler","itemDelHandler","_this3","url","getAttribute","img","Image","onload","src","removeAttribute","classList","toggle","_this4","toggleBusy","loadingClass","data","id","setTimeout","_this5","loadedItems","slice","itemsId","children","restore","perRow","setAttribute","LoadManager","_LoadManager2","_config","LoadManagerProxy","Promise","resolve","reject","callbackName","Math","round","random","body","removeChild","script","createElement","indexOf","appendChild","error","list","Array","isArray","push","StorageManager","type","sortProp","shownIds","JSON","parse","getItem","splice","storage","x","setItem","removeItem","isAvailable","stringify","items","sort","b","itemsToShow","count","every","item","totalNum","paginate","SubjectObserver","add","update","ViewManager","readyState","onreadystatechange","root","view","templateItems","innerHTML","message","stack","insertAdjacentHTML","parentNode","lastElementChild","templateItem","shown","imageUrl","text","json","isEmpty","loadManager","load","dom","viewManager","ready","all","then","result","eventManager","setEventHandlers","_LoadManagerProxy2","default","_ObserverList2","_ViewManager2","_StorageManager2","_EventManager2","save","setTotal","setHandlers","renderView","renderItems","renderErrorView","removeItemId","deleteItem","setObservers","z","g","m","A","c","owner","state_","data_","h","d","k","v","p","q","TypeError","w","C","D","y","then_","B","Polyfill","define","amd","E","setImmediate","prototype","constructor","fulfilled","rejected","catch","toString","race","global","self"],"mappings":"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","file":"app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n * EventManager - consumes config.js, sets handlers for users' actions\r\n */\r\n\r\nimport SubjectObserver from \"./SubjectObserver\";\r\n\r\nexport default class EventManager extends SubjectObserver {\r\n  constructor(ObserverList) {\r\n    super(ObserverList);\r\n    this.total = 0;\r\n    this.isBusy = false;\r\n    this.imgLoadFunc = 'lazyLoad';\r\n    this.noImgClass = 'no-image';\r\n    this.delay = 500;\r\n  }\r\n  setTotal(total) {\r\n    this.total = total;\r\n  }\r\n  toggleBusy() {\r\n    this.isBusy = !this.isBusy;\r\n  }\r\n  // carries out Subject-Observer relashionships defined in config.js\r\n  setObservers(config) {\r\n    config.forEach(subject => {\r\n      subject.notifies.forEach(evt => {\r\n        evt.observers.forEach(observer => {\r\n          subject.instance.addObserver(evt.name, observer.instance, observer.callback);\r\n        });\r\n      });\r\n    });\r\n  }\r\n  // App's behaviour. After getting users' behaviour data notifies dependants for main actions\r\n  setEventHandlers(storageManager) {\r\n      window[this.imgLoadFunc] = (elem) => this.imgLoadHandler(elem);\r\n      window.onerror = (msg) => {\r\n        this.notify('showError', new Error(msg));\r\n      }\r\n\r\n      document.getElementById(this.appId).addEventListener('click', event => {\r\n        let e = event || window.event, elem = e.target || e.srcElement;\r\n        if(elem.tagName.toLowerCase() !== 'button' || elem.disabled == true) return false;\r\n\r\n        if(elem.hasAttribute('data-download')) this.itemsDownloadHandler(elem, storageManager);\r\n        if(elem.hasAttribute('data-delete')) this.itemDelHandler(elem);\r\n      });\r\n  }\r\n  imgLoadHandler(elem) {\r\n    let url = elem.getAttribute('data-image');\r\n    let img = new Image();\r\n    img.onload = () => {\r\n      elem.src = url;\r\n      elem.onload = null;\r\n      elem.removeAttribute('onload');\r\n      elem.classList.toggle(this.noImgClass);\r\n      elem.removeAttribute('data-image');\r\n    }\r\n    img.src = url;\r\n  }\r\n  itemDelHandler(elem) {\r\n    if(this.isBusy) return false;\r\n    this.toggleBusy();\r\n    elem.classList.toggle(this.loadingClass);\r\n    let data = {\r\n      id: elem.getAttribute('data-delete'),\r\n      elem: elem\r\n    };\r\n    setTimeout(() => {\r\n      this.notify('removeElem', data);\r\n      this.toggleBusy();\r\n    }, this.delay);\r\n  }\r\n  itemsDownloadHandler(elem, storageManager) {\r\n    if(this.isBusy) return false;\r\n    this.toggleBusy();\r\n    elem.classList.toggle(this.loadingClass);\r\n    let loadedItems = [].slice.call(document.getElementById(this.itemsId).children).length;\r\n    if(this.total > loadedItems) {\r\n      setTimeout(() => {\r\n        this.notify('showMore', storageManager.restore());\r\n        elem.classList.toggle(this.loadingClass);\r\n        if(loadedItems + this.perRow >= this.total) elem.setAttribute('disabled', 'disabled');\r\n        this.toggleBusy();\r\n      }, this.delay);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Parent class for further implementations.\r\n */\r\nimport SubjectObserver from \"./SubjectObserver\";\r\n\r\nexport default class LoadManager extends SubjectObserver {\r\n  constructor(ObserverList) {\r\n    super(ObserverList);\r\n    this.url = 'http://81.177.101.143:30080/test.json';\r\n  }\r\n}\r\n","/**\r\n * Loading implementation using server-side Proxy. I use a free service\r\n * at http://www.whateverorigin.org which just returns JSON data via JSONP.\r\n */\r\nimport LoadManager from \"./LoadManager\";\r\nimport {Promise} from \"./config\";\r\n\r\nexport default class LoadManagerProxy extends LoadManager {\r\n  constructor(ObserverList) {\r\n    super(ObserverList);\r\n    this.url = \"http://www.whateverorigin.org/get?url=http://81.177.101.143:30080/test.json\";\r\n  }\r\n  load() {\r\n    return new Promise((resolve, reject) => {\r\n      // Lets get JSON with needed data via Proxy\r\n      let callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());\r\n      window[callbackName] = function(data) {\r\n        delete window[callbackName];\r\n        document.body.removeChild(script);\r\n        resolve(data);\r\n      };\r\n\r\n      let script = document.createElement('script');\r\n      script.src = this.url + (~this.url.indexOf('?') ? '&' : '?') + 'callback=' + callbackName;\r\n      document.body.appendChild(script);\r\n      script.onerror = function(error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n}\r\n","/**\r\n * ObserverList, adds and holds observers for the Subjects.\r\n * Observers - objects that depend somehow on the object they observe.\r\n */\r\nexport default class ObserverList {\r\n  constructor() {\r\n    this.list = {};\r\n  }\r\n  add(evt, observer, callback) {\r\n    if(!Array.isArray(this.list[evt])) this.list[evt] = [];\r\n    this.list[evt].push({\r\n      instance: observer,\r\n      callback: callback\r\n    });\r\n  }\r\n}\r\n","/**\r\n * StorageManager manages saving & retrieving data.\r\n * StorageManager initially always get exactly the same data\r\n * from the sessionStorage it saved upon getting. Then via functions\r\n * only chunks passed to the views.\r\n */\r\nimport SubjectObserver from \"./SubjectObserver\";\r\n\r\nexport default class StorageManager extends SubjectObserver {\r\n  constructor(ObserverList) {\r\n    super(ObserverList);\r\n    this.name = 'rostelecom';\r\n    this.data = null;\r\n    this.type = 'sessionStorage';\r\n    this.sortProp = 'age';\r\n    this.shownIds = []; // keeps track of what is currently shown\r\n  }\r\n  totalNum() {\r\n    if(this.data) return this.total = this.data.length;\r\n    return this.total = JSON.parse(window[this.type].getItem(this.name)).length;\r\n  }\r\n  removeItemId(data) { // removes an id from the list of the shown ids\r\n    if(~this.shownIds.indexOf(data.id)) this.shownIds.splice(this.shownIds.indexOf(data.id), 1);\r\n  }\r\n  isAvailable() {\r\n    try {\r\n      let storage = window[this.type], x = '__storage_test__';\r\n      storage.setItem(x, x);\r\n      storage.removeItem(x);\r\n      return true;\r\n    } catch(e) { return false; }\r\n  }\r\n  isEmpty() {\r\n    if(!this.isAvailable()) return true;\r\n    if(window[this.type].getItem(this.name)) return false; else return true;\r\n  }\r\n  save(data) {\r\n    if(!data) return false;\r\n    if(!this.isAvailable()) {\r\n      this.data = data;\r\n      return false;\r\n    }\r\n    try {\r\n      window[this.type].setItem(this.name, JSON.stringify(data));\r\n      return this.name;\r\n    } catch(e) {\r\n      this.data = data;\r\n      return false;\r\n    }\r\n  }\r\n  sort(items) { // due to slice() returns a new array, doesn't change the original one\r\n    return items.slice(0).sort((a, b) => {\r\n      return (a[this.sortProp] > b[this.sortProp]) ? 1 : (a[this.sortProp] < b[this.sortProp]) ? -1 : 0;\r\n    });\r\n  }\r\n  paginate(items) {\r\n    let itemsToShow = [], count = 0;\r\n    items.every(item => { // stop, if we got 4 items or there are no more items\r\n      if(count === this.perRow || this.shownIds.length === this.totalNum()) return false;\r\n      if(!~this.shownIds.indexOf(item.id)) {\r\n        itemsToShow.push(item);\r\n        this.shownIds.push(item.id);\r\n        count++;\r\n      }\r\n      return true;\r\n    });\r\n    return itemsToShow;\r\n  }\r\n  restore() { // returns already chunked data, not all the data\r\n    if(this.data) return this.paginate(this.sort(this.data));\r\n    return this.paginate(this.sort(JSON.parse(window[this.type].getItem(this.name))));\r\n  }\r\n}\r\n","/**\r\n * SubjectObserver, adds Subject/Observer functionality to the objects\r\n * and holds some common properties..\r\n * Subjects will emit a message to inform all the dependants that something important occurred;\r\n * Observers - are those dependants that will react somehow.\r\n */\r\nexport default class SubjectObserver {\r\n  constructor(ObserverList) {\r\n    this.observers = ObserverList;\r\n    this.appId = 'container';\r\n    this.itemsId = 'items';\r\n    this.loadingClass = 'loading';\r\n    this.perRow = 4;\r\n  }\r\n  // Subject methods\r\n  addObserver(evt, observer, callback) {\r\n    this.observers.add(evt, observer, callback);\r\n  }\r\n  notify(evt, data) {\r\n    this.observers.list[evt].forEach(observer => observer.instance.update(observer.callback, data) );\r\n  }\r\n  // Observer method\r\n  update(callback, data) {\r\n    callback.call(this, data);\r\n  }\r\n}\r\n","/**\r\n * ViewManageris responsible for the views and it also detects when the DOM is ready.\r\n */\r\nimport SubjectObserver from \"./SubjectObserver\";\r\nimport {Promise} from \"./config\";\r\n\r\nexport default class ViewManager extends SubjectObserver {\r\n  constructor(ObserverList) {\r\n    super(ObserverList);\r\n  }\r\n  ready() {\r\n    return new Promise((resolve, reject) => {\r\n      if(document.readyState === 'interactive' || document.readyState === 'complete') resolve(document.readyState);\r\n      document.onreadystatechange = function() {\r\n        if (~['interactive', 'complete'].indexOf(document.readyState)) {\r\n          resolve(document.readyState);\r\n          document.onreadystatechange = null;\r\n        }\r\n      }\r\n    });\r\n  }\r\n  renderView(data) {\r\n    let root = document.getElementById(this.appId);\r\n    let view = `<div id=\"${this.itemsId}\">${this.templateItems(data)}</div>\r\n                <button data-download><img src=\"spinner.gif\">download</button>`;\r\n    root.innerHTML = view;\r\n  }\r\n  renderErrorView(error) {\r\n    let root = document.getElementById(this.appId);\r\n    let view = `<div class=\"error\">Ups...something went wrong!\r\n                Try to visit this page later.<pre><code><strong>${error.name}</strong>\r\n${error.message}\r\n${error.stack}</code></pre></div>`;\r\n    root.innerHTML = view;\r\n  }\r\n  renderItems(data) {\r\n    let root = document.getElementById(this.itemsId);\r\n    root.insertAdjacentHTML('afterbegin', this.templateItems(data));\r\n  }\r\n  deleteItem(data) {\r\n    let elem = data.elem;\r\n    elem.classList.toggle(this.loadingClass);\r\n    let item = elem.parentNode.parentNode.parentNode;\r\n    item.parentNode.removeChild(item);\r\n    document.getElementById(this.appId).lastElementChild.removeAttribute('disabled');\r\n  }\r\n  templateItems(data) {\r\n    let items = ``;\r\n    data.forEach(item => {\r\n      items += this.templateItem(item);\r\n    });\r\n    return items;\r\n  }\r\n  templateItem(item) {\r\n    this.shown++;\r\n    return `<div class=\"item\">\r\n              <img data-image=\"${item.imageUrl}\" onload=\"lazyLoad(this)\" src=\"spinner.gif\" class=\"no-image\"/>\r\n              <div class=\"flex\">\r\n                <div class=\"content front\"><span>${item.name}</span></div>\r\n                <div class=\"content back\">\r\n                  <span>${item.name}</span>\r\n                  <span>${item.text}</span>\r\n                  <button data-delete=\"${item.id}\"><img src=\"spinner.gif\">delete</button>\r\n                </div>\r\n              </div>\r\n            </div>`;\r\n  }\r\n}\r\n","/**\r\n* Main flow of the app.\r\n*/\r\n\"use strict\";\r\nimport {loadManager, viewManager, storageManager, eventManager, Promise} from \"./config\";\r\n\r\nlet json = storageManager.isEmpty() ? loadManager.load() : Promise.resolve(false),\r\n    dom = viewManager.ready();\r\n\r\nPromise.all([json, dom])\r\n.then(result => {\r\n  try {\r\n    loadManager.notify('dataLoaded', result[0]['contents']);\r\n    loadManager.notify('totalNum', storageManager.totalNum());\r\n    eventManager.setEventHandlers(storageManager);\r\n    eventManager.notify('handlersReady', storageManager.restore());\r\n  } catch(e) {\r\n    eventManager.notify('showError', e);\r\n  }\r\n}, error => {\r\n   eventManager.notify('showError', error);\r\n});\r\n","/**\r\n * Config variable establishes Subject-Observer relashionships.\r\n */\r\nlet Promise = require('../../node_modules/es6-promise-polyfill/promise.min.js').Promise;\r\nimport ObserverList from './ObserverList';\r\nimport ViewManager from './ViewManager';\r\nimport EventManager from './EventManager';\r\nimport LoadManagerProxy from './LoadManagerProxy';\r\nimport StorageManager from './StorageManager';\r\n\r\n\r\nlet loadManager = new LoadManagerProxy(new ObserverList());\r\nlet viewManager = new ViewManager(new ObserverList());\r\nlet storageManager = new StorageManager(new ObserverList());\r\nlet eventManager = new EventManager(new ObserverList());\r\n\r\nconst config = [\r\n  {\r\n    instance: loadManager, // Subject, will inform the dependants\r\n    notifies: [{\r\n      name: 'dataLoaded',  // message\r\n      observers: [{\r\n        instance: storageManager,\r\n        callback: storageManager.save\r\n      }]\r\n    },{\r\n      name: 'totalNum',\r\n      observers: [{\r\n        instance: eventManager,\r\n        callback: eventManager.setTotal\r\n      }]\r\n    }]\r\n  },\r\n  {\r\n    instance: viewManager,\r\n    notifies: [{\r\n      name: 'domReady',\r\n      observers: [{\r\n        instance: eventManager,\r\n        callback: eventManager.setHandlers\r\n      }]\r\n    }]\r\n  },\r\n  {\r\n    instance: eventManager,\r\n    notifies: [{\r\n      name: 'handlersReady',\r\n      observers: [{\r\n        instance: viewManager,\r\n        callback: viewManager.renderView\r\n      }]\r\n    },{\r\n      name: 'showMore',\r\n      observers: [{\r\n        instance: viewManager,\r\n        callback: viewManager.renderItems\r\n      }]\r\n    },{\r\n      name: 'showError',\r\n      observers: [{\r\n        instance: viewManager,\r\n        callback: viewManager.renderErrorView\r\n      }]\r\n    },{\r\n      name: 'removeElem',\r\n      observers: [{\r\n        instance: storageManager,\r\n        callback: storageManager.removeItemId\r\n      },{\r\n        instance: viewManager,\r\n        callback: viewManager.deleteItem\r\n      }]\r\n    }]\r\n  }\r\n\r\n];\r\neventManager.setObservers(config);\r\nexport {loadManager, viewManager, storageManager, eventManager, Promise};\r\n","(function(t){function z(){for(var a=0;a<g.length;a++)g[a][0](g[a][1]);g=[];m=!1}function n(a,b){g.push([a,b]);m||(m=!0,A(z,0))}function B(a,b){function c(a){p(b,a)}function h(a){k(b,a)}try{a(c,h)}catch(d){h(d)}}function u(a){var b=a.owner,c=b.state_,b=b.data_,h=a[c];a=a.then;if(\"function\"===typeof h){c=l;try{b=h(b)}catch(d){k(a,d)}}v(a,b)||(c===l&&p(a,b),c===q&&k(a,b))}function v(a,b){var c;try{if(a===b)throw new TypeError(\"A promises callback cannot return that same promise.\");if(b&&(\"function\"===\ntypeof b||\"object\"===typeof b)){var h=b.then;if(\"function\"===typeof h)return h.call(b,function(d){c||(c=!0,b!==d?p(a,d):w(a,d))},function(b){c||(c=!0,k(a,b))}),!0}}catch(d){return c||k(a,d),!0}return!1}function p(a,b){a!==b&&v(a,b)||w(a,b)}function w(a,b){a.state_===r&&(a.state_=x,a.data_=b,n(C,a))}function k(a,b){a.state_===r&&(a.state_=x,a.data_=b,n(D,a))}function y(a){var b=a.then_;a.then_=void 0;for(a=0;a<b.length;a++)u(b[a])}function C(a){a.state_=l;y(a)}function D(a){a.state_=q;y(a)}function e(a){if(\"function\"!==\ntypeof a)throw new TypeError(\"Promise constructor takes a function argument\");if(!1===this instanceof e)throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");this.then_=[];B(a,this)}var f=t.Promise,s=f&&\"resolve\"in f&&\"reject\"in f&&\"all\"in f&&\"race\"in f&&function(){var a;new f(function(b){a=b});return\"function\"===typeof a}();\"undefined\"!==typeof exports&&exports?(exports.Promise=s?f:e,exports.Polyfill=e):\"function\"==\ntypeof define&&define.amd?define(function(){return s?f:e}):s||(t.Promise=e);var r=\"pending\",x=\"sealed\",l=\"fulfilled\",q=\"rejected\",E=function(){},A=\"undefined\"!==typeof setImmediate?setImmediate:setTimeout,g=[],m;e.prototype={constructor:e,state_:r,then_:null,data_:void 0,then:function(a,b){var c={owner:this,then:new this.constructor(E),fulfilled:a,rejected:b};this.state_===l||this.state_===q?n(u,c):this.then_.push(c);return c.then},\"catch\":function(a){return this.then(null,a)}};e.all=function(a){if(\"[object Array]\"!==\nObject.prototype.toString.call(a))throw new TypeError(\"You must pass an array to Promise.all().\");return new this(function(b,c){function h(a){e++;return function(c){d[a]=c;--e||b(d)}}for(var d=[],e=0,f=0,g;f<a.length;f++)(g=a[f])&&\"function\"===typeof g.then?g.then(h(f),c):d[f]=g;e||b(d)})};e.race=function(a){if(\"[object Array]\"!==Object.prototype.toString.call(a))throw new TypeError(\"You must pass an array to Promise.race().\");return new this(function(b,c){for(var e=0,d;e<a.length;e++)(d=a[e])&&\"function\"===\ntypeof d.then?d.then(b,c):b(d)})};e.resolve=function(a){return a&&\"object\"===typeof a&&a.constructor===this?a:new this(function(b){b(a)})};e.reject=function(a){return new this(function(b,c){c(a)})}})(\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this);\n"]}